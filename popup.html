<!DOCTYPE html>
<html>
    <head>
        <script src="jquery-1.6.2.min.js"></script> 
        <script>
            chrome.tabs.executeScript(null, { file: "jquery-1.6.2.min.js" },
                function() {
                    chrome.tabs.executeScript(null, { file: "jquery-ui-1.8.16.custom.min.js" })
                }
            );
            
            function getBase64Image(img) {
                // Create an empty canvas element
                var canvas = document.createElement("canvas");
                canvas.width = img.width;
                canvas.height = img.height;

                // Copy the image contents to the canvas
                var ctx = canvas.getContext("2d");
                ctx.drawImage(img, 0, 0);

                // Get the data-URL formatted image
                // Firefox supports PNG and JPEG. You could check img.src to
                // guess the original format, but be aware the using "image/jpg"
                // will re-encode the image.
                var dataURL = canvas.toDataURL("image/png");

                return dataURL.replace(/^data:image\/(png|jpg);base64,/, "");
            }
            
            var showOverlay = function() {
                chrome.tabs.executeScript(null, { file: "content.js" });
            }

            var showImage = function() {
                var url = 'http://www.google.ru/images/srpr/logo3w.png';
                var img = $("<img src='" + url+ "' />");
                img.load(function() {
                   var imageData = getBase64Image(this);
                   
                   chrome.tabs.executeScript(null, {
                        code:
                            "$('#overlay_3985123731465987').css('background'," +
                                "'url(data:image/png;base64," + imageData + ")');"
                        });
                   
                });
            }
        </script>
    </head>
    <body>
        <input type="button" value="Show/hide overlay" onclick="showOverlay();" />
        <input type="button" value="Show image" onclick="showImage();" />
    </body>
</html>
